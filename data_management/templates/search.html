<!doctype html>
<html>
{% extends "base.html" %}
{% block content %}
<head>
    <meta charset="utf-8">
    <title>Hacker Fab</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'data_management.css' %}">
    <style>
      table, th, td {
        border:1px solid black;
      }
      </style>
</head>
<body>
    <form action="search" method="POST">
        <div class = "process_sort" id="process_sort"> Select Processes to Sort By </div>
        {% for process in processes %}
            <input type="checkbox" id="{{process.id}}" name=" {{process.name}}" value=" {{process.name}}">
            <label for="{{process.id}}"> {{process.name}}</label><br>
        {% endfor %}
        <input type="submit" value="Submit">
        <input type="hidden" name="status" value="Initial">
        {% csrf_token %}
    </form>

    {% if link_id %}
    <form method="post" action="{% url 'csv_output' link_id %}">
      {% csrf_token %}
      <div class="csv"> 
        <button type="submit">Click to Download CSV</button>
      </div>
      
      {% comment %} Initialize a variable to keep track of the number of columns in the first entry {% endcomment %}
      {% with first_row_columns=output.0.items|length %}
      
      {% comment %} Start a new table {% endcomment %}
      <table style="width:100%">
        <tr>
          <th>Select</th>
          {% for column_name, value in output.0.items %} <!-- Header Row for Columns -->
            <th>{{ column_name }}</th>
          {% endfor %}
        </tr>

        {% for process_info in output %}
          {% comment %} Check if the current row has the same number of columns as the first row {% endcomment %}
          {% if process_info.items|length == first_row_columns %}
            <tr>
              <td>
                <input type="checkbox" name="selected_items" value="{{ forloop.counter0 }}">
              </td>
              {% for column_name, value in process_info.items %}
                {% if column_name == "picture" %}
                  <td>
                    <img src="{% url 'photo' process_info.process process_info.id %}" width="400" height="300" id="id_user_picture">
                  </td>
                {% else %}
                  <td>{{ value }}</td>
                {% endif %}
              {% endfor %}
            </tr>
          {% else %}
            {% comment %} If columns are different, start a new table {% endcomment %}
            </table>
            <table style="width:100%">
              <tr>
                <th>Select</th>
                {% for column_name, value in process_info.items %}
                  <th>{{ column_name }}</th>
                {% endfor %}
              </tr>
            <tr>
              <td>
                <input type="checkbox" name="selected_items" value="{{ forloop.counter0 }}">
              </td>
              {% for column_name, value in process_info.items %}
                {% if column_name == "picture" %}
                  <td>
                    <img src="{% url 'photo' process_info.process process_info.id %}" width="400" height="300" id="id_user_picture">
                  </td>
                {% else %}
                  <td>{{ value }}</td>
                {% endif %}
              {% endfor %}
            </tr>
          {% endif %}
        {% endfor %}
      </table>

      {% endwith %}
    </form>
{% endif %}

    
    {% if used_process %}
      <form action="search" method=POST enctype="multipart/form-data">
        {% for f in forms %}
          {{f.name}}
          <table>
              {{f.form}}
          </table>
        {% endfor %}
        <button  id="id_update_profile_button">Submit</button>
        <input type="hidden" name="status" value="Secondary">
        <input type="hidden" name="used_process" value={{used_process}}>
        {% csrf_token %}
    </form>
  {% endif %}
  
</body>
</html>
{% endblock %}